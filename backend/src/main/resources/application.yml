# ╔══════════════════════════════════════════════════════════════════╗
# ║  application.yml - アプリケーション設定ファイル                  ║
# ║                                                                  ║
# ║  Spring Boot の「設定コントロールパネル」です。                  ║
# ║  DB接続情報・サーバーポート・ログレベルなど、                    ║
# ║  アプリの動作を決める設定をここで一元管理します。                ║
# ║                                                                  ║
# ║  【重要】パスワードやDB URLはここに直書きしません！              ║
# ║  ${環境変数名} の形式で参照することで、                          ║
# ║  GitHub に push してもシークレット情報が漏れない設計にします。   ║
# ╚══════════════════════════════════════════════════════════════════╝

spring:
  application:
    name: bistro-lumiere-reservation

  datasource:
    # ──────────────────────────────────────────────────────────────────────
    # 【環境変数は DATABASE_URL の1つだけ設定すればOKです】
    #
    # Neon が発行する接続文字列をそのままコピー＆ペーストしてください。
    # 例:
    #   DATABASE_URL=postgresql://neondb_owner:パスワード@ep-xxx.neon.tech/neondb?sslmode=require
    #
    # DataSourceConfig.java が自動的に解析して JDBC 形式に変換します。
    # ユーザー名・パスワードを別々に設定する必要はありません。
    #
    # ただし DATABASE_URL が未設定の場合（ローカル開発など）は
    # 以下のフォールバック設定が使われます（テスト時は application-test.yml が優先）。
    # ──────────────────────────────────────────────────────────────────────
    url: ${DATABASE_URL:jdbc:postgresql://localhost:5432/bistro_lumiere}
    username: ${DATABASE_USERNAME:postgres}
    password: ${DATABASE_PASSWORD:}
    driver-class-name: org.postgresql.Driver

    # DataSourceConfig.java で DATABASE_URL が設定されている場合はそちらが優先されます。
    # 以下の Hikari 設定は DATABASE_URL 未設定時のフォールバック用です。
    hikari:
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
      maximum-pool-size: 5
      minimum-idle: 1
      connection-test-query: SELECT 1

  jpa:
    hibernate:
      # create-drop: 起動時にテーブルを作り直す（開発初期向け）
      # update:      既存テーブルに差分を適用する（開発中向け）
      # validate:    テーブル構造の確認のみ（本番向け）
      # none:        何もしない（本番向け）
      ddl-auto: update
    show-sql: true    # 発行されるSQLをコンソールに表示（デバッグ用）
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true   # SQLを整形して表示

server:
  port: 8080
  # エラーレスポンスにスタックトレースを含めない（セキュリティ対策）
  error:
    include-stacktrace: never
    include-message: never
    include-binding-errors: never

logging:
  level:
    com.bistrolumiere: DEBUG
    org.springframework.web: INFO
    org.springframework.security: WARN
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE
